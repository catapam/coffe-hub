{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5 product-page">
    <div class="row">
        <!-- Image Section -->
        <div class="col-md-6 d-flex align-items-center justify-content-center">
            <div class="card">
                <div class="background-gradient">
                    <div class="content-gradient">
                        <img class="card-img-top" src="{{ product.image }}" alt="{{ product.name }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Details Section -->
        <div class="col-md-6">
            <div class="card-body">
                <h2 class="card-title">{{ product.name }}</h2>

                <!-- Review Stars -->
                <div class="review-stars mb-3">
                    {% for star in total_review %}
                        {% if star < product.rating %}
                            <i class="star filled">★</i>
                        {% elif star < 5 %}
                            <i class="star">★</i>
                        {% endif %}
                    {% endfor %}
                </div>

                <p class="card-text">{{ product.description }}</p>

                <!-- Size and Quantity Selectors -->
                <div class="d-flex gap-3 mb-3">
                    <!-- Size Selector -->
                    <div class="w-50">
                        <label for="size-select" class="form-label">Size</label>
                        <select id="size-select" class="form-select">
                            {% for size in sizes %}
                                <option value="{{ size }}" {% if size == default_size %}selected{% endif %}>
                                    {{ size }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Quantity Selector -->
                    <div class="w-50">
                        <label for="quantity-select" class="form-label">Quantity</label>
                        <input id="quantity-select" type="number" class="form-control" min="1" value="1">
                    </div>
                </div>

                <!-- Price Display -->
                <div class="d-flex justify-content-end mb-3">
                    <h4 class="mb-0"><strong>${{ product.price }}</strong></h4>
                </div>

                <!-- Buy Button and Stock Display -->
                <a href="{{ product.get_buy_url }}" class="btn btn-secondary btn-lg mt-3">
                    Buy
                </a>
                <div class="d-flex flex-column align-items-center">
                    <!-- Stock Display -->
                    <p id="stock-display" class="text-muted mb-3 align-items-center">{{ default_stock_status }}</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}

<!-- Page specific scripts -->
{% block extra_js %}
{{ block.super }}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const sizeSelect = document.getElementById("size-select");
        const stockDisplay = document.getElementById("stock-display");

        // Stock mapping from the context
        const stockBySize = {{ stock_by_size|safe }};

        // Update stock display when size is changed
        sizeSelect.addEventListener("change", function () {
            const selectedSize = sizeSelect.value;
            const stock = stockBySize[selectedSize] || 0;
            const stockStatus = stock > 0 ? "In Stock" : "Out of Stock";
            stockDisplay.innerHTML = `<strong>${stockStatus}</strong>`;
        });
    });
</script>
{% endblock %}